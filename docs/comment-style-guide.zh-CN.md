# 注释风格指南（中文）

本文档规定了Fangjia Qt6 C++项目的注释标准，确保代码可读性和术语一致性。

## 总体原则

### 目标导向
- 注释解释"为什么/设计意图"，避免赘述"代码在做什么"
- 删除重复、与代码矛盾、或显而易见的注释
- 删除注释掉的死代码块

### 语言规范
- 统一使用中文全角标点（，。；：）
- 术语使用固定译法，保留专有名词（Qt类名、OpenGL API等）原文
- 行宽建议不超过100字符

## 注释类型与格式

### 文件头部注释
所有源文件和头文件必须包含标准化文件头：

```cpp
/*
 * 文件名：FileName.h/cpp
 * 职责：该文件的核心职责与边界（数据/渲染/UI/平台适配等）。
 * 依赖：关键外部模块/库。
 * 线程：线程使用假设（如仅UI线程）。
 * 备注：平台差异/所有权/生命周期等注意事项。
 */
```

### 类/结构体注释
使用Doxygen风格的`///`注释：

```cpp
/// 类职责描述
/// 
/// 功能：
/// - 主要功能点1
/// - 主要功能点2
/// 
/// 使用方式：
/// 简要的使用示例或注意事项
class MyClass {
    // ...
};
```

### 函数/方法注释
公共接口和复杂内部函数需要详细注释：

```cpp
/// 功能：函数的主要功能描述
/// 参数：param1 — 参数含义/单位/取值范围
/// 参数：param2 — 参数含义/单位/取值范围  
/// 返回：返回值含义和可能的特殊值
/// 说明：副作用/线程安全性/性能注意事项
ReturnType functionName(ParamType1 param1, ParamType2 param2);
```

简单的getter/setter可精简或省略注释。

### 内联注释
仅在"非直观"逻辑处补充，使用`//`：

```cpp
// DPR（设备像素比）换算：逻辑像素 -> 设备像素
int devicePixels = logicalPixels * dpr;

// 坐标系转换：左上原点 -> OpenGL底左原点
int glY = fbHeight - y - height;
```

## 术语标准化

### 核心术语
- **DPR（设备像素比）**：统一写作"DPR（设备像素比）"
- **像素单位**：以"像素(px) / 逻辑像素(ln)"表达，必要时注明换算
- **剪裁**：统一使用"剪裁"而非"裁剪"
- **纹理**：统一使用"纹理"而非"贴图"

### UI术语
- **布局策略**：measure-arrange两阶段布局
- **事件转发**：事件分发与冒泡机制
- **指针捕获**：鼠标事件捕获机制
- **主题传播**：主题变化的递归传播

### 渲染术语
- **坐标系**：逻辑像素坐标系 vs OpenGL NDC坐标系
- **着色器**：顶点着色器、片段着色器
- **白膜策略**：单色模板通过着色器着色的技术

## 模块特定要求

### Renderer模块
重点说明：
- 像素->NDC坐标转换
- DPR（设备像素比）计算
- 剪裁矩形的坐标系转换（左上原点 vs OpenGL底左原点）

### UI组件模块
重点说明：
- 容器布局策略（measure-arrange流程）
- 事件转发/捕获机制
- 主题传播机制

### ThemeManager模块
重点说明：
- 系统主题监听机制
- 模式有效值推导逻辑

### MainOpenGlWindow模块
重点说明：
- 生命周期管理
- 页面路由机制
- 动画驱动节流

### IconLoader/IconCache模块
重点说明：
- 白膜策略（tint）
- 文字栅格化注意点

## 实施检查清单

### 删除项目
- [ ] 明显重复的注释
- [ ] 过时的注释（与实现不符）
- [ ] 注释掉的旧代码块
- [ ] 显而易见的注释

### 修订项目
- [ ] 零散/口语化注释改为完整语句
- [ ] 统一标点符号使用
- [ ] 混杂英文注释改为标准中文
- [ ] 纠正与实现不一致的描述

### 补充项目
- [ ] 关键模块增加文件头注释
- [ ] 复杂/核心函数增加详细注释
- [ ] 非直观逻辑增加内联说明

## 示例对比

### 修改前（不规范）
```cpp
// Helper function to convert ThemeMode to string
QString modeToString(const ThemeManager::ThemeMode m) {
    // ...
}

// 设置默认的 OpenGL 上下文参数
QSurfaceFormat fmt;
```

### 修改后（规范）
```cpp
/// 功能：将主题模式枚举转换为字符串表示
/// 参数：m — 主题模式枚举值
/// 返回：对应的字符串标识符（"system"/"light"/"dark"）
QString modeToString(const ThemeManager::ThemeMode m) {
    // ...
}

// 设置默认的OpenGL上下文参数
QSurfaceFormat fmt;
```

---

遵循本指南可确保代码注释的一致性、准确性和可读性。如有疑问，请参考现有代码中的规范示例。